{"ast":null,"code":"import _objectSpread from\"/Users/mdearaujo/Downloads/LETZ/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/Users/mdearaujo/Downloads/LETZ/frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";const _excluded=[\"children\",\"value\",\"index\"];import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{Box,Container,Typography,Paper,Button,Grid,Avatar,Chip,List,ListItem,ListItemText,ListItemAvatar,ListItemSecondaryAction,IconButton,Alert,CircularProgress,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControlLabel,Checkbox,Tabs,Tab}from'@mui/material';import{LocationOn as LocationIcon,CalendarToday as CalendarIcon,People as PeopleIcon,AttachMoney as MoneyIcon,Share as ShareIcon,Edit as EditIcon,Delete as DeleteIcon,Add as AddIcon,Check as CheckIcon,Person as PersonIcon,Assignment as AssignmentIcon}from'@mui/icons-material';import{useAppSelector}from'../hooks/redux';import{eventAPI,eventItemAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index}=props,other=_objectWithoutProperties(props,_excluded);return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({role:\"tabpanel\",hidden:value!==index,id:\"event-tabpanel-\".concat(index),\"aria-labelledby\":\"event-tab-\".concat(index)},other),{},{children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{py:3},children:children})}));}function EventDetailsPage(){const{eventId}=useParams();const navigate=useNavigate();const{user}=useAppSelector(state=>state.auth);const[event,setEvent]=useState(null);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);const[tabValue,setTabValue]=useState(0);const[shareDialogOpen,setShareDialogOpen]=useState(false);const[itemDialogOpen,setItemDialogOpen]=useState(false);const[newItem,setNewItem]=useState({name:'',description:'',quantity:1,category:'',isRequired:false,isMonetary:false,estimatedCost:0});useEffect(()=>{if(eventId){loadEventDetails();}},[eventId]);const loadEventDetails=async()=>{try{setIsLoading(true);const response=await eventAPI.getEventById(Number(eventId));setEvent(response.data);}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Erro ao carregar detalhes do evento');}finally{setIsLoading(false);}};const handleJoinEvent=async()=>{try{if(!event)return;await eventAPI.joinEvent(event.id);await loadEventDetails();// Recarregar para atualizar participantes\n}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Erro ao participar do evento');}};const handleLeaveEvent=async()=>{try{if(!event)return;await eventAPI.leaveEvent(event.id);await loadEventDetails();// Recarregar para atualizar participantes\n}catch(error){var _error$response3,_error$response3$data;setError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Erro ao sair do evento');}};const handleAddItem=async()=>{try{if(!event)return;await eventItemAPI.createEventItem(event.id,newItem);setItemDialogOpen(false);setNewItem({name:'',description:'',quantity:1,category:'',isRequired:false,isMonetary:false,estimatedCost:0});await loadEventDetails();// Recarregar para atualizar itens\n}catch(error){var _error$response4,_error$response4$data;setError(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'Erro ao adicionar item');}};const handleAssignItem=async(itemId,userId)=>{try{if(!event)return;await eventItemAPI.assignItem(event.id,itemId,userId);await loadEventDetails();// Recarregar para atualizar itens\n}catch(error){var _error$response5,_error$response5$data;setError(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||'Erro ao atribuir item');}};const handleCompleteItem=async itemId=>{try{if(!event)return;await eventItemAPI.completeItem(event.id,itemId);await loadEventDetails();// Recarregar para atualizar itens\n}catch(error){var _error$response6,_error$response6$data;setError(((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.message)||'Erro ao marcar item como concluído');}};const copyInviteLink=()=>{if(event){const inviteUrl=\"\".concat(window.location.origin,\"/invite/\").concat(event.inviteCode);navigator.clipboard.writeText(inviteUrl);// Aqui você poderia mostrar uma notificação de sucesso\n}};const isParticipant=event===null||event===void 0?void 0:event.participants.some(p=>p.id===(user===null||user===void 0?void 0:user.id));const isCreator=(event===null||event===void 0?void 0:event.creator.id)===(user===null||user===void 0?void 0:user.id);const canEdit=isCreator;if(isLoading){return/*#__PURE__*/_jsx(Container,{maxWidth:\"lg\",sx:{py:4,display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error||!event){return/*#__PURE__*/_jsx(Container,{maxWidth:\"lg\",sx:{py:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error||'Evento não encontrado'})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{py:4},children:[/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:4,mb:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',mb:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{flex:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:event.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{mb:2},children:event.description}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2,flexWrap:'wrap',mb:2},children:[/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(CalendarIcon,{}),label:new Date(event.startDateTime).toLocaleString('pt-BR'),variant:\"outlined\"}),/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(LocationIcon,{}),label:event.location,variant:\"outlined\"}),/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(PeopleIcon,{}),label:\"\".concat(event.participants.length).concat(event.maxParticipants?\"/\".concat(event.maxParticipants):'',\" participantes\"),variant:\"outlined\"}),event.hasCostSharing&&event.totalCost&&/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(MoneyIcon,{}),label:\"R$ \".concat(event.totalCost.toFixed(2)),variant:\"outlined\",color:\"warning\"})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(ShareIcon,{}),onClick:()=>setShareDialogOpen(true),children:\"Compartilhar\"}),canEdit&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(EditIcon,{}),onClick:()=>navigate(\"/events/\".concat(event.id,\"/edit\")),children:\"Editar\"}),/*#__PURE__*/_jsx(IconButton,{color:\"error\",children:/*#__PURE__*/_jsx(DeleteIcon,{})})]})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2},children:[!isParticipant&&!isCreator&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleJoinEvent,size:\"large\",children:\"Participar do Evento\"}),isParticipant&&!isCreator&&/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",onClick:handleLeaveEvent,children:\"Sair do Evento\"}),isCreator&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"primary\",sx:{alignSelf:'center'},children:\"Voc\\xEA \\xE9 o organizador deste evento\"})]})]}),/*#__PURE__*/_jsxs(Paper,{elevation:3,children:[/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:(e,newValue)=>setTabValue(newValue),children:[/*#__PURE__*/_jsx(Tab,{label:\"Participantes (\".concat(event.participants.length,\")\")}),/*#__PURE__*/_jsx(Tab,{label:\"Itens (\".concat(event.items.length,\")\")}),/*#__PURE__*/_jsx(Tab,{label:\"Informa\\xE7\\xF5es\"})]})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:0,children:/*#__PURE__*/_jsx(List,{children:event.participants.map(participant=>/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(PersonIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(participant.firstName,\" \").concat(participant.lastName),secondary:participant.email}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(Chip,{label:participant.status,color:participant.status==='CONFIRMED'?'success':'warning',size:\"small\"})})]},participant.id))})}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:1,children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Lista de Itens\"}),(isCreator||isParticipant)&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>setItemDialogOpen(true),children:\"Adicionar Item\"})]}),/*#__PURE__*/_jsxs(List,{children:[event.items.map(item=>{var _item$assignedTo;return/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AssignmentIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",children:[item.name,\" (\",item.quantity,\")\"]}),item.isRequired&&/*#__PURE__*/_jsx(Chip,{label:\"Obrigat\\xF3rio\",size:\"small\",color:\"error\"}),item.isCompleted&&/*#__PURE__*/_jsx(Chip,{label:\"Conclu\\xEDdo\",size:\"small\",color:\"success\"})]}),secondary:/*#__PURE__*/_jsxs(Box,{children:[item.description&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:item.description}),item.assignedTo&&/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"primary\",children:[\"Atribu\\xEDdo a: \",item.assignedTo.firstName,\" \",item.assignedTo.lastName]}),item.isMonetary&&item.estimatedCost&&/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"warning.main\",children:[\"Custo estimado: R$ \",item.estimatedCost.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[!item.assignedTo&&(isCreator||isParticipant)&&/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:()=>handleAssignItem(item.id,user.id),children:\"Assumir\"}),((_item$assignedTo=item.assignedTo)===null||_item$assignedTo===void 0?void 0:_item$assignedTo.id)===(user===null||user===void 0?void 0:user.id)&&!item.isCompleted&&/*#__PURE__*/_jsx(IconButton,{color:\"success\",onClick:()=>handleCompleteItem(item.id),children:/*#__PURE__*/_jsx(CheckIcon,{})})]})})]},item.id);}),event.items.length===0&&/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Nenhum item adicionado ainda\",secondary:\"Adicione itens necess\\xE1rios para o evento\"})})]})]}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:2,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Detalhes do Evento\"}),/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Tipo\",secondary:event.type})}),/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Data/Hora de In\\xEDcio\",secondary:new Date(event.startDateTime).toLocaleString('pt-BR')})}),event.endDateTime&&/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Data/Hora de T\\xE9rmino\",secondary:new Date(event.endDateTime).toLocaleString('pt-BR')})}),/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Local\",secondary:event.address||event.location})})]})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:6,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Organizador\"}),/*#__PURE__*/_jsx(List,{children:/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(PersonIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(event.creator.firstName,\" \").concat(event.creator.lastName),secondary:event.creator.email})]})})]})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:shareDialogOpen,onClose:()=>setShareDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Compartilhar Evento\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{mb:2},children:\"Compartilhe este link para convidar pessoas para o evento:\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,value:\"\".concat(window.location.origin,\"/invite/\").concat(event.inviteCode),InputProps:{readOnly:true}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShareDialogOpen(false),children:\"Fechar\"}),/*#__PURE__*/_jsx(Button,{onClick:copyInviteLink,variant:\"contained\",children:\"Copiar Link\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:itemDialogOpen,onClose:()=>setItemDialogOpen(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Adicionar Item\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'column',gap:2,pt:1},children:[/*#__PURE__*/_jsx(TextField,{label:\"Nome do Item\",value:newItem.name,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{name:e.target.value})),fullWidth:true,required:true}),/*#__PURE__*/_jsx(TextField,{label:\"Descri\\xE7\\xE3o\",value:newItem.description,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{description:e.target.value})),fullWidth:true,multiline:true,rows:2}),/*#__PURE__*/_jsx(TextField,{label:\"Quantidade\",type:\"number\",value:newItem.quantity,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{quantity:Number(e.target.value)})),fullWidth:true,inputProps:{min:1}}),/*#__PURE__*/_jsx(TextField,{label:\"Categoria\",value:newItem.category,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{category:e.target.value})),fullWidth:true}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:newItem.isRequired,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{isRequired:e.target.checked}))}),label:\"Item obrigat\\xF3rio\"}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:newItem.isMonetary,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{isMonetary:e.target.checked}))}),label:\"Item monet\\xE1rio\"}),newItem.isMonetary&&/*#__PURE__*/_jsx(TextField,{label:\"Custo Estimado (R$)\",type:\"number\",value:newItem.estimatedCost,onChange:e=>setNewItem(_objectSpread(_objectSpread({},newItem),{},{estimatedCost:Number(e.target.value)})),fullWidth:true,inputProps:{min:0,step:0.01}})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setItemDialogOpen(false),children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleAddItem,variant:\"contained\",disabled:!newItem.name,children:\"Adicionar\"})]})]})]});}export default EventDetailsPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}