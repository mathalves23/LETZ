{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{Box,Container,Paper,List,ListItem,ListItemAvatar,ListItemText,Avatar,Typography,TextField,IconButton,Badge,Grid,Chip,InputAdornment,CircularProgress}from'@mui/material';import{Send as SendIcon,Search as SearchIcon,VideoCall as VideoCallIcon,Phone as PhoneIcon,MoreVert as MoreVertIcon}from'@mui/icons-material';import{useSelector}from'react-redux';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MessagesPage=()=>{const{user}=useSelector(state=>state.auth);const[selectedChat,setSelectedChat]=useState(null);const[message,setMessage]=useState('');const[messages,setMessages]=useState([]);const[chats,setChats]=useState([]);const[searchQuery,setSearchQuery]=useState('');const[loading,setLoading]=useState(false);const[typing,setTyping]=useState(false);const messagesEndRef=useRef(null);const wsRef=useRef(null);// Chats mockados para demonstraÃ§Ã£o\nconst mockChats=[{id:1,participantId:2,participantName:'JoÃ£o Silva',participantAvatar:'/avatars/joao.jpg',lastMessage:'Vamos confirmar o churrasco para sÃ¡bado?',lastMessageTime:new Date(Date.now()-5*60*1000),unreadCount:2,isOnline:true,eventId:1,eventName:'Churrasco de Fim de Semana'},{id:2,participantId:3,participantName:'Maria Santos',participantAvatar:'/avatars/maria.jpg',lastMessage:'Preciso confirmar quantas pessoas vÃ£o...',lastMessageTime:new Date(Date.now()-20*60*1000),unreadCount:0,isOnline:true},{id:3,participantId:4,participantName:'Pedro Costa',participantAvatar:'/avatars/pedro.jpg',lastMessage:'A festa foi incrÃ­vel! Obrigado pela organizaÃ§Ã£o ðŸŽ‰',lastMessageTime:new Date(Date.now()-2*60*60*1000),unreadCount:0,isOnline:false}];const mockMessages=[{id:1,senderId:2,senderName:'JoÃ£o Silva',content:'Oi! Como estÃ¡ o planejamento do churrasco?',timestamp:new Date(Date.now()-60*60*1000),isRead:true},{id:2,senderId:(user===null||user===void 0?void 0:user.id)||1,senderName:(user===null||user===void 0?void 0:user.firstName)||'VocÃª',content:'Oi JoÃ£o! EstÃ¡ indo bem. JÃ¡ confirmaram 15 pessoas.',timestamp:new Date(Date.now()-50*60*1000),isRead:true},{id:3,senderId:2,senderName:'JoÃ£o Silva',content:'Perfeito! Vou levar a churrasqueira portÃ¡til e o carvÃ£o.',timestamp:new Date(Date.now()-30*60*1000),isRead:true},{id:4,senderId:2,senderName:'JoÃ£o Silva',content:'Vamos confirmar o churrasco para sÃ¡bado?',timestamp:new Date(Date.now()-5*60*1000),isRead:false}];useEffect(()=>{setChats(mockChats);if(mockChats.length>0){setSelectedChat(mockChats[0]);setMessages(mockMessages);}},[]);useEffect(()=>{scrollToBottom();},[messages]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const formatTime=date=>{const now=new Date();const diff=now.getTime()-date.getTime();const minutes=Math.floor(diff/(1000*60));const hours=Math.floor(diff/(1000*60*60));const days=Math.floor(diff/(1000*60*60*24));if(minutes<60){return\"\".concat(minutes,\"min\");}else if(hours<24){return\"\".concat(hours,\"h\");}else{return\"\".concat(days,\"d\");}};const handleSendMessage=async()=>{if(!message.trim()||!selectedChat)return;const newMessage={id:messages.length+1,senderId:(user===null||user===void 0?void 0:user.id)||1,senderName:(user===null||user===void 0?void 0:user.firstName)||'VocÃª',content:message,timestamp:new Date(),isRead:false};setMessages(prev=>[...prev,newMessage]);setMessage('');// Simular resposta automÃ¡tica para demonstraÃ§Ã£o\nsetTimeout(()=>{const responseMessage={id:messages.length+2,senderId:selectedChat.participantId,senderName:selectedChat.participantName,content:'Mensagem recebida! ðŸ‘',timestamp:new Date(),isRead:false};setMessages(prev=>[...prev,responseMessage]);},2000);};const handleKeyPress=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage();}};const filteredChats=chats.filter(chat=>{var _chat$eventName;return chat.participantName.toLowerCase().includes(searchQuery.toLowerCase())||((_chat$eventName=chat.eventName)===null||_chat$eventName===void 0?void 0:_chat$eventName.toLowerCase().includes(searchQuery.toLowerCase()));});return/*#__PURE__*/_jsxs(Container,{maxWidth:\"xl\",sx:{py:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,sx:{mb:3,fontWeight:600},children:\"\\uD83D\\uDCAC Mensagens\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{height:'calc(100vh - 200px)'},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Paper,{sx:{height:'100%',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Box,{sx:{p:2,borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,size:\"small\",placeholder:\"Buscar conversas...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{})})}})}),/*#__PURE__*/_jsx(List,{sx:{flex:1,overflow:'auto',p:0},children:filteredChats.map(chat=>/*#__PURE__*/_jsxs(ListItem,{button:true,selected:(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===chat.id,onClick:()=>{setSelectedChat(chat);setMessages(mockMessages);},sx:{borderBottom:1,borderColor:'divider','&.Mui-selected':{backgroundColor:'primary.light','&:hover':{backgroundColor:'primary.light'}}},children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Badge,{color:\"success\",variant:\"dot\",invisible:!chat.isOnline,anchorOrigin:{vertical:'bottom',horizontal:'right'},children:/*#__PURE__*/_jsx(Avatar,{src:chat.participantAvatar,children:chat.participantName.charAt(0)})})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",noWrap:true,children:chat.participantName}),chat.lastMessageTime&&/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:formatTime(chat.lastMessageTime)})]}),secondary:/*#__PURE__*/_jsxs(Box,{children:[chat.eventName&&/*#__PURE__*/_jsx(Chip,{size:\"small\",label:chat.eventName,color:\"primary\",variant:\"outlined\",sx:{mb:0.5,maxWidth:'100%'}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",noWrap:true,children:chat.lastMessage})]})}),chat.unreadCount>0&&/*#__PURE__*/_jsx(Badge,{badgeContent:chat.unreadCount,color:\"error\"})]},chat.id))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:selectedChat?/*#__PURE__*/_jsxs(Paper,{sx:{height:'100%',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Box,{sx:{p:2,borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsx(Badge,{color:\"success\",variant:\"dot\",invisible:!selectedChat.isOnline,children:/*#__PURE__*/_jsx(Avatar,{src:selectedChat.participantAvatar,children:selectedChat.participantName.charAt(0)})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:selectedChat.participantName}),selectedChat.eventName&&/*#__PURE__*/_jsx(Chip,{size:\"small\",label:selectedChat.eventName,color:\"primary\",variant:\"outlined\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:selectedChat.isOnline?'Online':'Offline'})]})]}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(PhoneIcon,{})}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(VideoCallIcon,{})}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(MoreVertIcon,{})})]})]})}),/*#__PURE__*/_jsxs(Box,{sx:{flex:1,overflow:'auto',p:2},children:[messages.map(msg=>/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:msg.senderId===(user===null||user===void 0?void 0:user.id)?'flex-end':'flex-start',mb:1},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,maxWidth:'70%',backgroundColor:msg.senderId===(user===null||user===void 0?void 0:user.id)?'primary.main':'grey.100',color:msg.senderId===(user===null||user===void 0?void 0:user.id)?'white':'text.primary'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:msg.content}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",sx:{display:'block',mt:0.5,opacity:0.7},children:msg.timestamp.toLocaleTimeString()})]})},msg.id)),typing&&/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,mt:1},children:[/*#__PURE__*/_jsx(Avatar,{src:selectedChat.participantAvatar,sx:{width:24,height:24},children:selectedChat.participantName.charAt(0)}),/*#__PURE__*/_jsxs(Paper,{sx:{p:1,backgroundColor:'grey.100'},children:[/*#__PURE__*/_jsx(CircularProgress,{size:12}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",sx:{ml:1},children:\"Digitando...\"})]})]}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(Box,{sx:{p:2,borderTop:1,borderColor:'divider'},children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,maxRows:3,placeholder:\"Digite sua mensagem...\",value:message,onChange:e=>setMessage(e.target.value),onKeyPress:handleKeyPress,InputProps:{endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",onClick:handleSendMessage,disabled:!message.trim(),children:/*#__PURE__*/_jsx(SendIcon,{})})})}})})]}):/*#__PURE__*/_jsx(Paper,{sx:{height:'100%',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.secondary\",gutterBottom:true,children:\"Selecione uma conversa\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Escolha uma conversa da lista para come\\xE7ar a trocar mensagens\"})]})})})]})]});};export default MessagesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}